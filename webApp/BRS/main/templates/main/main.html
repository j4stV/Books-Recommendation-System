{% load static %} <!-- Подключаем папку static -->
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="globals.css"/>
    <link rel="stylesheet" href="{% static 'main/css/main.css' %}"/>
</head>
<body>
<div class="main-screen-logged">
    <header class="header">
        <div class="logo-and-pages">
            <div class="logo">
                <div class="overlap-group">
                    <img class="img" src="{% static 'main/assets/logo.png' %}"/>
                    <div class="text-wrapper">Books Recommendation System</div>
                </div>
            </div>
            <div class="pages">
                <div class="div"><a href="/{{ user_id }}">Recommended</a></div>
                <div class="div"><a href="/{{ user_id }}/history">Reading History</a></div>
                <div class="div"><a href="/search">Search</a></div>
            </div>
        </div>
        <div class="login-button">
            <div class="overlap">
                <a href="/login">
                    <div class="group"><img class="user" src="{% static 'main/assets/user%201.svg' %}"/></div>
                    <div class="text-wrapper-2">
                        {% if user_id %}
                            {{ user_id }}
                        {% else %}
                            Log in
                        {% endif %}
                    </div>
                </a>
            </div>
        </div>
    </header>
    <div class="main">
        <div class="div-2">
            <div class="text-wrapper-3">Recommendations for you,
            {% if user_id %}
                {{ user_id }}
            {% else %}
                Log in
            {% endif %}
            </div>
            <div class="carousel" id="Recommendations">
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-3"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="frame">
                    <div class="group-wrapper">
                        <div class="overlap-group-wrapper">
                            <div class="overlap-group-2">
                                <img class="line" src="{% static 'main/assets/Line%201.svg' %}"/> <img class="line-2" src="{% static 'main/assets/Line%202.svg' %}"/>
                            </div>
                        </div>
                    </div>
                    <div class="text-wrapper-5">1</div>
                </div>
            </div>
        </div>
        <div class="div-2">
            <div class="text-wrapper-3">Popular</div>
            <div class="carousel" id="Popular">
                <div class="book">
                    <div class="rectangle"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-2"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="book">
                    <div class="rectangle-2"></div>
                    <div class="text-wrapper-4">Book Title</div>
                </div>
                <div class="frame">
                    <div class="group-wrapper">
                        <div class="overlap-group-wrapper">
                            <div class="overlap-group-2">
                                <img class="line" src="{% static 'main/assets/Line%201.svg' %}"/> <img class="line-2" src="{% static 'main/assets/Line%202.svg' %}"/>
                            </div>
                        </div>
                    </div>
                    <div class="text-wrapper-5">Text</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function updateCarousel(books, id) {
        let carousel = document.getElementById(id);
        carousel.innerHTML = '';

        books.forEach(book => {
            let bookDiv = document.createElement('div');
            bookDiv.className = 'book';

            let rectangleDiv = document.createElement('div');
            rectangleDiv.className = 'rectangle-3';

            let img = document.createElement('img');
            img.className = 'book-img'
            img.src = decodeURIComponent(book['image_l'].substring(1)).replace('http:/', 'http://');
            console.log(decodeURIComponent(book['image_l'].substring(1)));
            console.log(img.src);
            rectangleDiv.appendChild(img);

            let titleDiv = document.createElement('div');
            titleDiv.className = 'text-wrapper-4';
            titleDiv.textContent = book['title'];

            bookDiv.appendChild(rectangleDiv);
            bookDiv.appendChild(titleDiv);

            carousel.appendChild(bookDiv);
        });
        carousel.innerHTML = carousel.innerHTML + '\
        <div class="frame"> \
            <div class="group-wrapper"> \
            <div class="overlap-group-wrapper"> \
            <div class="overlap-group-2"> \
                <img class="line" src="{% static "main/assets/Line%201.svg" %}"/> <img class="line-2" src="{% static "main/assets/Line%202.svg" %}"/> \
            </div> \
            </div> \
            </div> \
            <div class="text-wrapper-5">1</div> \
        </div>';
    }

    function getRecommendations(userId) {
        fetch('/api/recommendations/' + userId)
        .then(response => response.json())
        .then(books => updateCarousel(books, "Recommendations"))
        .catch(error => console.error('Error:', error));
    }

    function getPopularBooks() {
        fetch('/api/popular/')
        .then(response => response.json())
        .then(books => updateCarousel(books, "Popular"))
        .catch(error => console.error('Error:', error));
    }

    var userId = "{{ user_id }}";
    getRecommendations(userId);
    getPopularBooks();
</script>
</body>
</html>
